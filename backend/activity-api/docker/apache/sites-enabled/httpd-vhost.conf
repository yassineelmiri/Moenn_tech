<VirtualHost *:80>
    ServerName localhost

    DocumentRoot /var/www/public
    DirectoryIndex /index.php

    <Directory /var/www/public>
#         AllowOverride None
#         Order Allow,Deny
#         Allow from All

        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        <IfModule mod_rewrite.c>

            Options -MultiViews

            RewriteEngine On
            RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
            RewriteRule ^(.*) - [E=BASE:%1]

            RewriteCond %{HTTP:Authorization} .
            RewriteRule ^ - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

            RewriteCond %{ENV:REDIRECT_STATUS} ^$
            RewriteRule ^index\.php(?:/(.*)|$) %{ENV:BASE}/$1 [R=301,L]

            RewriteCond %{REQUEST_FILENAME} -f
            RewriteRule ^ - [L]

            RewriteRule ^ %{ENV:BASE}/index.php [L]

            RewriteRule ^Swagger/ui - [L]

        </IfModule>

        <IfModule !mod_rewrite.c>
            <IfModule mod_alias.c>
                RedirectMatch 307 ^/$ /index.php/

            </IfModule>
        </IfModule>

        FallbackResource /index.php
    </Directory>

    <Directory /var/www/public/bundles>
        FallbackResource disabled
    </Directory>
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined
</VirtualHost>

<VirtualHost *:443>

    ServerName localhost

    DocumentRoot /var/www/public
    DirectoryIndex /index.php

    # DocumentRoot ${APACHE_ROOT_DIR}/htdocs/public

    #<Directory ${APACHE_ROOT_DIR}/htdocs/public>
    <Directory /var/www/public>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted

        <IfModule mod_rewrite.c>

            Options -MultiViews

            RewriteEngine On
            RewriteCond %{REQUEST_URI}::$1 ^(/.+)/(.*)::\2$
            RewriteRule ^(.*) - [E=BASE:%1]

            RewriteCond %{HTTP:Authorization} .
            RewriteRule ^ - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

            RewriteCond %{ENV:REDIRECT_STATUS} ^$
            RewriteRule ^index\.php(?:/(.*)|$) %{ENV:BASE}/$1 [R=301,L]

            RewriteCond %{REQUEST_FILENAME} -f
            RewriteRule ^ - [L]

            RewriteRule ^ %{ENV:BASE}/index.php [L]

            RewriteRule ^Swagger/ui - [L]

        </IfModule>

        <IfModule !mod_rewrite.c>
            <IfModule mod_alias.c>
                RedirectMatch 307 ^/$ /index.php/

            </IfModule>
        </IfModule>

    </Directory>

    SSLEngine on
    SSLCertificateFile "/var/www/ops/ssl/localhost.crt"
    SSLCertificateKeyFile "/var/www/ops/ssl/localhost.key"
    #SSLCertificateFile "${APACHE_ROOT_DIR}/certificates/localhost.crt"
    #SSLCertificateKeyFile "${APACHE_ROOT_DIR}/certificates/localhost.key"

    ErrorLog /var/log/apache2/error_ssl.log
    CustomLog /var/log/apache2/access_ssl.log common

</VirtualHost>
